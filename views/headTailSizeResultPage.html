<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center"><%= title %></h1>
        <div class="mb-4">
            <a href="/" class="btn btn-primary">Quay lại trang chính</a>
        </div>
        <form id="paramForm" class="mb-4 mt-4">
            <div class="row g-4">
                <div class="col-md-4">
                    <label for="startDate" class="form-label">Ngày bắt đầu:</label>
                    <input type="date" class="form-control" id="startDate" name="startDate" value="<%= options.startDate %>">
                </div>
                <div class="col-md-4">
                    <label for="endDate" class="form-label">Ngày kết thúc:</label>
                    <input type="date" class="form-control" id="endDate" name="endDate" value="<%= options.endDate %>">
                </div>
                <div class="col-md-4">
                    <label for="mode" class="form-label">Chế độ:</label>
                    <select class="form-select" id="mode" name="mode">
                        <option value="de" <%= options.mode === 'de' ? 'selected' : '' %>>Đề</option>
                        <option value="lo" <%= options.mode === 'lo' ? 'selected' : '' %>>Lô</option>
                        <option value="prize1" <%= options.mode === 'prize1' ? 'selected' : '' %>>Giải nhất</option>
                        <option value="prize2" <%= options.mode === 'prize2' ? 'selected' : '' %>>Giải nhì</option>
                        <option value="prize3" <%= options.mode === 'prize3' ? 'selected' : '' %>>Giải ba</option>
                        <option value="prize4" <%= options.mode === 'prize4' ? 'selected' : '' %>>Giải tư</option>
                        <option value="prize5" <%= options.mode === 'prize5' ? 'selected' : '' %>>Giải năm</option>
                        <option value="prize6" <%= options.mode === 'prize6' ? 'selected' : '' %>>Giải sáu</option>
                        <option value="prize7" <%= options.mode === 'prize7' ? 'selected' : '' %>>Giải bảy</option>
                        <option value="pos1" <%= options.mode === 'pos1' ? 'selected' : '' %>>Vị trí 1 (Giải nhất)</option>
                        <option value="pos2" <%= options.mode === 'pos2' ? 'selected' : '' %>>Vị trí 2 (Giải nhì 1)</option>
                        <option value="pos3" <%= options.mode === 'pos3' ? 'selected' : '' %>>Vị trí 3 (Giải nhì 2)</option>
                        <option value="pos4" <%= options.mode === 'pos4' ? 'selected' : '' %>>Vị trí 4 (Giải ba 1)</option>
                        <option value="pos5" <%= options.mode === 'pos5' ? 'selected' : '' %>>Vị trí 5 (Giải ba 2)</option>
                        <option value="pos6" <%= options.mode === 'pos6' ? 'selected' : '' %>>Vị trí 6 (Giải ba 3)</option>
                        <option value="pos7" <%= options.mode === 'pos7' ? 'selected' : '' %>>Vị trí 7 (Giải ba 4)</option>
                        <option value="pos8" <%= options.mode === 'pos8' ? 'selected' : '' %>>Vị trí 8 (Giải ba 5)</option>
                        <option value="pos9" <%= options.mode === 'pos9' ? 'selected' : '' %>>Vị trí 9 (Giải ba 6)</option>
                        <option value="pos10" <%= options.mode === 'pos10' ? 'selected' : '' %>>Vị trí 10 (Giải tư 1)</option>
                        <option value="pos11" <%= options.mode === 'pos11' ? 'selected' : '' %>>Vị trí 11 (Giải tư 2)</option>
                        <option value="pos12" <%= options.mode === 'pos12' ? 'selected' : '' %>>Vị trí 12 (Giải tư 3)</option>
                        <option value="pos13" <%= options.mode === 'pos13' ? 'selected' : '' %>>Vị trí 13 (Giải tư 4)</option>
                        <option value="pos14" <%= options.mode === 'pos14' ? 'selected' : '' %>>Vị trí 14 (Giải năm 1)</option>
                        <option value="pos15" <%= options.mode === 'pos15' ? 'selected' : '' %>>Vị trí 15 (Giải năm 2)</option>
                        <option value="pos16" <%= options.mode === 'pos16' ? 'selected' : '' %>>Vị trí 16 (Giải năm 3)</option>
                        <option value="pos17" <%= options.mode === 'pos17' ? 'selected' : '' %>>Vị trí 17 (Giải năm 4)</option>
                        <option value="pos18" <%= options.mode === 'pos18' ? 'selected' : '' %>>Vị trí 18 (Giải năm 5)</option>
                        <option value="pos19" <%= options.mode === 'pos19' ? 'selected' : '' %>>Vị trí 19 (Giải năm 6)</option>
                        <option value="pos20" <%= options.mode === 'pos20' ? 'selected' : '' %>>Vị trí 20 (Giải sáu 1)</option>
                        <option value="pos21" <%= options.mode === 'pos21' ? 'selected' : '' %>>Vị trí 21 (Giải sáu 2)</option>
                        <option value="pos22" <%= options.mode === 'pos22' ? 'selected' : '' %>>Vị trí 22 (Giải sáu 3)</option>
                        <option value="pos23" <%= options.mode === 'pos23' ? 'selected' : '' %>>Vị trí 23 (Giải bảy 1)</option>
                        <option value="pos24" <%= options.mode === 'pos24' ? 'selected' : '' %>>Vị trí 24 (Giải bảy 2)</option>
                        <option value="pos25" <%= options.mode === 'pos25' ? 'selected' : '' %>>Vị trí 25 (Giải bảy 3)</option>
                        <option value="pos26" <%= options.mode === 'pos26' ? 'selected' : '' %>>Vị trí 26 (Giải bảy 4)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="consecutiveDays" class="form-label">Số ngày liên tiếp:</label>
                    <select class="form-select" id="consecutiveDays" name="consecutiveDays">
                        <option value="2" <%= options.consecutiveDays === 2 ? 'selected' : '' %>>2 ngày</option>
                        <option value="3" <%= options.consecutiveDays === 3 ? 'selected' : '' %>>3 ngày</option>
                        <option value="4" <%= options.consecutiveDays === 4 ? 'selected' : '' %>>4 ngày</option>
                        <option value="5" <%= options.consecutiveDays === 5 ? 'selected' : '' %>>5 ngày</option>
                        <option value="6" <%= options.consecutiveDays === 6 ? 'selected' : '' %>>6 ngày</option>
                        <option value="7" <%= options.consecutiveDays === 7 ? 'selected' : '' %>>7 ngày</option>
                        <option value="8" <%= options.consecutiveDays === 8 ? 'selected' : '' %>>8 ngày</option>
                        <option value="9" <%= options.consecutiveDays === 9 ? 'selected' : '' %>>9 ngày</option>
                        <option value="10" <%= options.consecutiveDays === 10 ? 'selected' : '' %>>10 ngày</option>
                        <option value="11" <%= options.consecutiveDays === 11 ? 'selected' : '' %>>11 ngày</option>
                        <option value="12" <%= options.consecutiveDays === 12 ? 'selected' : '' %>>12 ngày</option>
                        <option value="13" <%= options.consecutiveDays === 13 ? 'selected' : '' %>>13 ngày</option>
                        <option value="14" <%= options.consecutiveDays === 14 ? 'selected' : '' %>>14 ngày</option>
                        <option value="15" <%= options.consecutiveDays === 15 ? 'selected' : '' %>>15 ngày</option>
                        <option value="16" <%= options.consecutiveDays === 16 ? 'selected' : '' %>>16 ngày</option>
                        <option value="17" <%= options.consecutiveDays === 17 ? 'selected' : '' %>>17 ngày</option>
                        <option value="18" <%= options.consecutiveDays === 18 ? 'selected' : '' %>>18 ngày</option>
                        <option value="19" <%= options.consecutiveDays === 19 ? 'selected' : '' %>>19 ngày</option>
                        <option value="20" <%= options.consecutiveDays === 20 ? 'selected' : '' %>>20 ngày</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="sizeType" class="form-label">Dạng To/Nhỏ:</label>
                    <select class="form-select" id="sizeType" name="sizeType">
                        <option value="big-big" <%= options.sizeType === 'big-big' ? 'selected' : '' %>>Đầu To - Đít To</option>
                        <option value="big-small" <%= options.sizeType === 'big-small' ? 'selected' : '' %>>Đầu To - Đít Nhỏ</option>
                        <option value="small-big" <%= options.sizeType === 'small-big' ? 'selected' : '' %>>Đầu Nhỏ - Đít To</option>
                        <option value="small-small" <%= options.sizeType === 'small-small' ? 'selected' : '' %>>Đầu Nhỏ - Đít Nhỏ</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="pattern" class="form-label">Kiểu chuỗi:</label>
                    <select class="form-select" id="pattern" name="pattern">
                        <option value="consecutive_occurrence" <%= options.pattern === 'consecutive_occurrence' ? 'selected' : '' %>>Về liên tiếp</option>
                        <option value="monotonic_increasing" <%= options.pattern === 'monotonic_increasing' ? 'selected' : '' %>>Tăng dần</option>
                        <option value="monotonic_decreasing" <%= options.pattern === 'monotonic_decreasing' ? 'selected' : '' %>>Giảm dần</option>
                        <option value="arithmetic_increasing" <%= options.pattern === 'arithmetic_increasing' ? 'selected' : '' %>>Tăng dần ĐỀU</option>
                        <option value="arithmetic_decreasing" <%= options.pattern === 'arithmetic_decreasing' ? 'selected' : '' %>>Giảm dần ĐỀU</option>
                    </select>
                </div>
                
                    <button type="submit" class="btn btn-primary">Thống kê</button>
                
            </div>
        </form>
        <% if (results && results.length > 0) { %>
            <p><b>Tổng số trường hợp tìm thấy: <%= total %></b>. <%= message %></p>
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 25%;">Ngày bắt đầu - kết thúc</th>
                        <th style="width: 25%;">Chuỗi tìm thấy</th>
                        <th style="width: 50%;">Kết quả chi tiết (Mode: <%= options.mode.toUpperCase() %>)</th>
                    </tr>
                </thead>
                <tbody>
                    <% results.forEach(result => { %>
                        <tr>
                            <td>
                                <% if (result.dates && result.dates.length > 0) { %>
                                    <%= formatDate(result.dates[0]) %> - <%= formatDate(result.dates[result.dates.length - 1]) %>
                                <% } %>
                            </td>
                            <td>
                                <span class="highlight fs-5"><%= result.sequence.map(n=>String(n).padStart(2,'0')).join(' → ') %></span>
                            </td>
                            <td>
                                <% if (result.results && result.results.length > 0) { %>
                                    <% result.results.forEach(dayResult => { %>
                                        <div>
                                            <small class="text-muted"><%= formatDate(dayResult.date) %>:</small>
                                            <% dayResult.numbers.forEach(num => { %>
                                                <% if (dayResult.matched.includes(num)) { %>
                                                    <span class="highlight"><%= String(num).padStart(2, '0') %></span>
                                                <% } else { %>
                                                    <span><%= String(num).padStart(2, '0') %></span>
                                                <% } %>
                                            <% }) %>
                                        </div>
                                    <% }) %>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } else { %>
            <p class="text-center mt-4">Không tìm thấy kết quả nào phù hợp với tiêu chí của bạn.</p>
        <% } %>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('paramForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            const url = new URL(form.action);
            url.searchParams.set('startDate', form.elements.startDate.value);
            url.searchParams.set('endDate', form.elements.endDate.value);
            url.searchParams.set('mode', form.elements.mode.value);
            url.searchParams.set('consecutiveDays', form.elements.consecutiveDays.value);
            url.searchParams.set('pattern', form.elements.pattern.value);
            url.searchParams.set('sizeType', form.elements.sizeType.value); // Thêm tham số mới
            window.location.href = url.toString();
        });

        document.getElementById('endDate').addEventListener('change', function () {
            const endDateValue = this.value;
            if (endDateValue) {
                const endDate = new Date(endDateValue);
                const startDate = new Date(endDate);
                startDate.setDate(endDate.getDate() - 360);
                document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            }
        });
    </script>
</body>
</html>